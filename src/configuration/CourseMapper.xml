<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="mapper.CourseMapper">
    <insert id="insertCourse" useGeneratedKeys="true" keyProperty="c_id">
        INSERT INTO course (u_id,c_name,c_type,c_date,c_praise,c_operation,c_firstImage) VALUE (#{user.u_id},#{c_name},#{c_type},#{c_date},#{c_praise},#{c_operation},#{c_firstImage});
    </insert>
    <update id="updateCoursePraise">
      UPDATE course SET c_praise=c_praise+1 where c_id=#{c_id};
    </update>
    <!--映射-->
    <resultMap type="entities.Course"  id="courseResultMap">
        <id property="c_id" column="c_id"></id>
        <result property="c_date" column="c_date"></result>
        <result property="c_firstImage" column="c_firstImage"></result>
        <result property="c_name" column="c_name"></result>
        <result property="c_operation" column="c_operation"></result>
        <result property="c_praise" column="c_praise"></result>
        <result property="c_type" column="c_type"></result>
        <association property="user" column="u_id" javaType="entities.User">
            <result property="username" column="username"></result>
        </association>
    </resultMap>
    <select id="selectCourse" resultMap="courseResultMap">
        SELECT `user`.username,course.c_id,course.c_name,course.c_praise,course.c_operation,course.c_date  from course,user WHERE course.c_id=#{c_id} and course.u_id=`user`.u_id
    </select>
    <select id="selectAllCourse" resultType="entities.Course">
      SELECT c_id,c_type,c_firstImage,c_name from course WHERE c_type=#{c_type} limit #{calculationPageNumber},16;
    </select>
    <select id="selectPageCount" resultType="java.lang.Integer">
        SELECT  count(*) FROM course  WHERE c_type=#{c_type};
    </select>
    <select id="selectNewCate" resultType="entities.Course">
        SELECT c_id,c_name,c_type,c_date FROM course ORDER BY c_date DESC LIMIT 0,13
    </select>
    <select id="selectIndexNewCate" resultType="entities.Course">
        SELECT c_id,c_name,c_type,c_firstImage FROM course ORDER BY c_date DESC LIMIT 0,6
    </select>
    <select id="selectIndexchoiceCourse" resultType="entities.Course">
        SELECT c_id,c_name,c_firstImage FROM course ORDER BY c_praise DESC LIMIT 0,12
    </select>
    <select id="selectChoiceCourse" resultType="entities.Course">
        SELECT c_id,c_praise,c_firstImage,c_name from course order by  c_praise desc  limit #{calculationPageNumber},32;
    </select>
    <select id="selectChoicePageCount" resultType="java.lang.Integer">
        SELECT  count(*) FROM course ;
    </select>
    <select id="fuzzySearch" resultType="entities.Course">
        select c_id,c_name,c_firstImage,c_type from course
        <where>
            <if test="c_name!=null and c_name!=''">
                c_name LIKE '%${c_name}%'
            </if>
        </where>
        LIMIT  #{calculationPageNumber},6
    </select>
    <select id="fuzzySearchCount" resultType="java.lang.Integer">
        SELECT count(*) FROM course where   c_name LIKE '%${c_name}%'
    </select>
</mapper>